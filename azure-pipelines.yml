trigger:
- master

pr:
- master

jobs:
- job: iOS
  pool:
    vmImage: 'macOS-10.15'
    
  steps:
  - script: |
      git submodule update --init --recursive
    displayName: 'Checkout dependencies'
      
  - script: |
      cmake --version
    displayName: 'CMake version'

  - script: |
      sudo xcode-select --switch /Applications/Xcode_11.3.1.app/Contents/Developer
    displayName: 'Select XCode 11.3.1'

  - script: |
      mkdir buildiOS
      cd buildiOS
      cmake .. -G Xcode -DCMAKE_TOOLCHAIN_FILE=../Dependencies/ios-cmake/ios.toolchain.cmake -DPLATFORM=OS64COMBINED -DENABLE_ARC=0 -DDEPLOYMENT_TARGET=13 -DENABLE_GLSLANG_BINARIES=OFF -DSPIRV_CROSS_CLI=OFF
    displayName: 'Generate iOS solution'

  - task: Xcode@5
    inputs:
      xcWorkspacePath: 'buildiOS/BabylonNative.xcodeproj'
      scheme: 'Playground'
      sdk: 'iphonesimulator'
      useXcpretty: false
    displayName: 'Build iOS'
  - script: |
      mkdir Results
      xcrun simctl list
      echo " **** booting ..."
      xcrun simctl boot A73F7BD9-4151-48AF-B290-0B054DCB5286
      echo " **** installing ..."
      xcrun simctl install booted buildiOS/Apps/Playground/Debug-iphonesimulator/Playground.app
      echo " **** Launching ..."
      xcrun simctl launch booted com.BabylonNative.Playground.iOS
      sleep 10
      xcrun simctl io booted screenshot Results/screen.png
    displayName: 'Test iOS Simulator'
  - task: PublishBuildArtifacts@1
    inputs:
      artifactName: 'iOS Rendered Pictures'
      pathtoPublish: 'Results'
    displayName: 'Publish Tests iOS Results'
#xcrun simctl create My-iphone com.apple.CoreSimulator.SimDeviceType.iPhone-11 com.apple.CoreSimulator.SimRuntime.iOS-13â€“0